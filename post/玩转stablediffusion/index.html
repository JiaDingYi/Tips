<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>玩转StableDiffusion | Tips</title><meta name=keywords content="StableDiffusion"><meta name=description content="玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 为什么选择 Stable Diffusion？ 开发环节，先在iOS上跑起来（简述） Core ML Stable Diffusion 下载模型 模型解压缩 生成 StableDiffusionPipeline 文生图 证书设置 最终效果 在各种设备上把 Stable Diffusion 玩起来 iOS MacOS Draw Things App Stable Diffusion WebUI SD Web UI 环境搭建 （略） Windows PC 云服务器 傻瓜式部署流程 不同方案的优势和限制 iPhone、iPad Mac OS 使用 Draw Things App： 使用 Stable Diffusion Web UI Windows PC 使用 Stable Diffusion Web UI 云服务器 使用 Stable Diffusion Web UI 手把手教你生成一张专业摄影图 手把手教你给模特换装 ControlNet的其他妙用 玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 举个例子："><meta name=author content="Jdy"><link rel=canonical href=https://jiadingyi.github.io/Tips/post/%E7%8E%A9%E8%BD%ACstablediffusion/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/Tips/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/Tips/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://jiadingyi.github.io/Tips/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://jiadingyi.github.io/Tips/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://jiadingyi.github.io/Tips/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://jiadingyi.github.io/Tips/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://jiadingyi.github.io/Tips/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="玩转StableDiffusion"><meta property="og:description" content="玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 为什么选择 Stable Diffusion？ 开发环节，先在iOS上跑起来（简述） Core ML Stable Diffusion 下载模型 模型解压缩 生成 StableDiffusionPipeline 文生图 证书设置 最终效果 在各种设备上把 Stable Diffusion 玩起来 iOS MacOS Draw Things App Stable Diffusion WebUI SD Web UI 环境搭建 （略） Windows PC 云服务器 傻瓜式部署流程 不同方案的优势和限制 iPhone、iPad Mac OS 使用 Draw Things App： 使用 Stable Diffusion Web UI Windows PC 使用 Stable Diffusion Web UI 云服务器 使用 Stable Diffusion Web UI 手把手教你生成一张专业摄影图 手把手教你给模特换装 ControlNet的其他妙用 玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 举个例子："><meta property="og:type" content="article"><meta property="og:url" content="https://jiadingyi.github.io/Tips/post/%E7%8E%A9%E8%BD%ACstablediffusion/"><meta property="og:image" content="https://jiadingyi.github.io/Tips/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-05-30T10:30:43+08:00"><meta property="article:modified_time" content="2023-05-30T10:30:43+08:00"><meta property="og:site_name" content="Tips"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://jiadingyi.github.io/Tips/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="玩转StableDiffusion"><meta name=twitter:description content="玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 为什么选择 Stable Diffusion？ 开发环节，先在iOS上跑起来（简述） Core ML Stable Diffusion 下载模型 模型解压缩 生成 StableDiffusionPipeline 文生图 证书设置 最终效果 在各种设备上把 Stable Diffusion 玩起来 iOS MacOS Draw Things App Stable Diffusion WebUI SD Web UI 环境搭建 （略） Windows PC 云服务器 傻瓜式部署流程 不同方案的优势和限制 iPhone、iPad Mac OS 使用 Draw Things App： 使用 Stable Diffusion Web UI Windows PC 使用 Stable Diffusion Web UI 云服务器 使用 Stable Diffusion Web UI 手把手教你生成一张专业摄影图 手把手教你给模特换装 ControlNet的其他妙用 玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 举个例子："><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://jiadingyi.github.io/Tips/post/"},{"@type":"ListItem","position":2,"name":"玩转StableDiffusion","item":"https://jiadingyi.github.io/Tips/post/%E7%8E%A9%E8%BD%ACstablediffusion/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"玩转StableDiffusion","name":"玩转StableDiffusion","description":"玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 为什么选择 Stable Diffusion？ 开发环节，先在iOS上跑起来（简述） Core ML Stable Diffusion 下载模型 模型解压缩 生成 StableDiffusionPipeline 文生图 证书设置 最终效果 在各种设备上把 Stable Diffusion 玩起来 iOS MacOS Draw Things App Stable Diffusion WebUI SD Web UI 环境搭建 （略） Windows PC 云服务器 傻瓜式部署流程 不同方案的优势和限制 iPhone、iPad Mac OS 使用 Draw Things App： 使用 Stable Diffusion Web UI Windows PC 使用 Stable Diffusion Web UI 云服务器 使用 Stable Diffusion Web UI 手把手教你生成一张专业摄影图 手把手教你给模特换装 ControlNet的其他妙用 玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 举个例子：","keywords":["StableDiffusion"],"articleBody":" 玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 为什么选择 Stable Diffusion？ 开发环节，先在iOS上跑起来（简述） Core ML Stable Diffusion 下载模型 模型解压缩 生成 StableDiffusionPipeline 文生图 证书设置 最终效果 在各种设备上把 Stable Diffusion 玩起来 iOS MacOS Draw Things App Stable Diffusion WebUI SD Web UI 环境搭建 （略） Windows PC 云服务器 傻瓜式部署流程 不同方案的优势和限制 iPhone、iPad Mac OS 使用 Draw Things App： 使用 Stable Diffusion Web UI Windows PC 使用 Stable Diffusion Web UI 云服务器 使用 Stable Diffusion Web UI 手把手教你生成一张专业摄影图 手把手教你给模特换装 ControlNet的其他妙用 玩转 Stable diffusion（落地实操版） 什么是 Midjourney、Stable Diffusion 举个例子：\n可以将他们类比为画家的手和工具，根据你打的文字和选择的不同参数，来画出你想要的作品。\n但是画出什么风格的作品，取决于模型。\n可以把模型类比为画家的大脑，提示词和参数就是灵感。\n为什么选择 Stable Diffusion？ 可以在大多数配备有适度GPU的电脑硬件上运行 项目代码及模型权重开源，开源社区开发者可以在它的基础上进行二次开发 免费、无需注册 与 Midjourney 相比，配置略微繁琐。（过去式，下面将分享傻瓜式教程） 开发环节，先在iOS上跑起来（简述） Core ML Stable Diffusion github\n苹果专门为 Stable Diffusion 推出的工具，作用有两个：\n将模型转换为 CoreML 格式 以 Swift 代码调用 CoreML 模型实现图像生成。 支持 CPU、GPU、NE（神经引擎、专为深度学习任务设计的硬件加速器） 等多种运行方式 下载模型 Huggingface上已有转换好的模型，我们可以直接下载。\n@discardableResult func download() async throws -\u003e URL { if ready || downloaded { return downloadedURL } let downloader = Downloader(from: url, to: downloadedURL) self.downloader = downloader downloadSubscriber = downloader.downloadState.sink { state in if case .downloading(let progress) = state { self.state = .downloading(progress) } } try downloader.waitUntilDone() return downloadedURL } 模型解压缩 func unzip() async throws { guard downloaded else { return } state = .uncompressing do { try FileManager().unzipItem(at: downloadedURL, to: uncompressPath.url) } catch { // Cleanup if error occurs while unzipping try uncompressPath.delete() throw error } try downloadedPath.delete() state = .readyOnDisk } 生成 StableDiffusionPipeline func load(url: URL) async throws -\u003e StableDiffusionPipeline { let beginDate = Date() let configuration = MLModelConfiguration() configuration.computeUnits = computeUnits let pipeline = try StableDiffusionPipeline(resourcesAt: url, configuration: configuration, disableSafety: false, reduceMemory: model.reduceMemory) print(\"Pipeline loaded in \\(Date().timeIntervalSince(beginDate))\") state = .loaded return pipeline } 文生图 /// Text to image generation using stable diffusion /// /// - Parameters: /// - prompt: Text prompt to guide sampling /// - negativePrompt: Negative text prompt to guide sampling /// - stepCount: Number of inference steps to perform /// - imageCount: Number of samples/images to generate for the input prompt /// - seed: Random seed which /// - guidanceScale: Controls the influence of the text prompt on sampling process (0=random images) /// - disableSafety: Safety checks are only performed if `self.canSafetyCheck \u0026\u0026 !disableSafety` /// - progressHandler: Callback to perform after each step, stops on receiving false response /// - Returns: An array of `imageCount` optional images. /// The images will be nil if safety checks were performed and found the result to be un-safe public func generateImages( prompt: String, negativePrompt: String = \"\", imageCount: Int = 1, stepCount: Int = 50, seed: UInt32 = 0, guidanceScale: Float = 7.5, disableSafety: Bool = false, scheduler: StableDiffusionScheduler = .pndmScheduler, progressHandler: (Progress) -\u003e Bool = { _ in true } ) throws -\u003e [CGImage?] { // Encode the input prompt and negative prompt let promptEmbedding = try textEncoder.encode(prompt) let negativePromptEmbedding = try textEncoder.encode(negativePrompt) if reduceMemory { textEncoder.unloadResources() } // Convert to Unet hidden state representation // Concatenate the prompt and negative prompt embeddings let concatEmbedding = MLShapedArray( concatenating: [negativePromptEmbedding, promptEmbedding], alongAxis: 0 ) let hiddenStates = toHiddenStates(concatEmbedding) /// Setup schedulers let scheduler: [Scheduler] = (0..","wordCount":"1043","inLanguage":"en","datePublished":"2023-05-30T10:30:43+08:00","dateModified":"2023-05-30T10:30:43+08:00","author":{"@type":"Person","name":"Jdy"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://jiadingyi.github.io/Tips/post/%E7%8E%A9%E8%BD%ACstablediffusion/"},"publisher":{"@type":"Organization","name":"Tips","logo":{"@type":"ImageObject","url":"https://jiadingyi.github.io/Tips/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jiadingyi.github.io/Tips/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://jiadingyi.github.io/Tips/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://jiadingyi.github.io/Tips/>Home</a>&nbsp;»&nbsp;<a href=https://jiadingyi.github.io/Tips/post/>Posts</a></div><h1 class=post-title>玩转StableDiffusion</h1><div class=post-meta><span title='2023-05-30 10:30:43 +0800 CST'>May 30, 2023</span>&nbsp;·&nbsp;Jdy</div></header><div class=post-content><ul><li><a href=#%E7%8E%A9%E8%BD%AC-stable-diffusion%E8%90%BD%E5%9C%B0%E5%AE%9E%E6%93%8D%E7%89%88>玩转 Stable diffusion（落地实操版）</a><ul><li><a href=#%E4%BB%80%E4%B9%88%E6%98%AF-midjourneystable-diffusion>什么是 Midjourney、Stable Diffusion</a></li><li><a href=#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89%E6%8B%A9-stable-diffusion>为什么选择 Stable Diffusion？</a></li><li><a href=#%E5%BC%80%E5%8F%91%E7%8E%AF%E8%8A%82%E5%85%88%E5%9C%A8ios%E4%B8%8A%E8%B7%91%E8%B5%B7%E6%9D%A5%E7%AE%80%E8%BF%B0>开发环节，先在iOS上跑起来（简述）</a><ul><li><a href=#core-ml-stable-diffusion>Core ML Stable Diffusion</a></li><li><a href=#%E4%B8%8B%E8%BD%BD%E6%A8%A1%E5%9E%8B>下载模型</a></li><li><a href=#%E6%A8%A1%E5%9E%8B%E8%A7%A3%E5%8E%8B%E7%BC%A9>模型解压缩</a></li><li><a href=#%E7%94%9F%E6%88%90-stablediffusionpipeline>生成 StableDiffusionPipeline</a></li><li><a href=#%E6%96%87%E7%94%9F%E5%9B%BE>文生图</a></li><li><a href=#%E8%AF%81%E4%B9%A6%E8%AE%BE%E7%BD%AE>证书设置</a></li><li><a href=#%E6%9C%80%E7%BB%88%E6%95%88%E6%9E%9C>最终效果</a></li></ul></li><li><a href=#%E5%9C%A8%E5%90%84%E7%A7%8D%E8%AE%BE%E5%A4%87%E4%B8%8A%E6%8A%8A-stable-diffusion-%E7%8E%A9%E8%B5%B7%E6%9D%A5>在各种设备上把 Stable Diffusion 玩起来</a><ul><li><a href=#ios>iOS</a></li><li><a href=#macos>MacOS</a><ul><li><a href=#draw-things-app>Draw Things App</a></li><li><a href=#stable-diffusion-webui>Stable Diffusion WebUI</a><ul><li><a href=#sd-web-ui-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA-%E7%95%A5>SD Web UI 环境搭建 （略）</a></li></ul></li></ul></li><li><a href=#windows-pc>Windows PC</a></li><li><a href=#%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8>云服务器</a><ul><li><a href=#%E5%82%BB%E7%93%9C%E5%BC%8F%E9%83%A8%E7%BD%B2%E6%B5%81%E7%A8%8B>傻瓜式部署流程</a></li></ul></li></ul></li><li><a href=#%E4%B8%8D%E5%90%8C%E6%96%B9%E6%A1%88%E7%9A%84%E4%BC%98%E5%8A%BF%E5%92%8C%E9%99%90%E5%88%B6>不同方案的优势和限制</a><ul><li><a href=#iphoneipad>iPhone、iPad</a></li><li><a href=#mac-os>Mac OS</a><ul><li><a href=#%E4%BD%BF%E7%94%A8-draw-things-app>使用 Draw Things App：</a></li><li><a href=#%E4%BD%BF%E7%94%A8-stable-diffusion-web-ui>使用 Stable Diffusion Web UI</a></li></ul></li><li><a href=#windows-pc-1>Windows PC</a><ul><li><a href=#%E4%BD%BF%E7%94%A8-stable-diffusion-web-ui-1>使用 Stable Diffusion Web UI</a></li></ul></li><li><a href=#%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8-1>云服务器</a><ul><li><a href=#%E4%BD%BF%E7%94%A8-stable-diffusion-web-ui-2>使用 Stable Diffusion Web UI</a></li></ul></li></ul></li><li><a href=#%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E7%94%9F%E6%88%90%E4%B8%80%E5%BC%A0%E4%B8%93%E4%B8%9A%E6%91%84%E5%BD%B1%E5%9B%BE>手把手教你生成一张专业摄影图</a></li><li><a href=#%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E7%BB%99%E6%A8%A1%E7%89%B9%E6%8D%A2%E8%A3%85>手把手教你给模特换装</a></li><li><a href=#controlnet%E7%9A%84%E5%85%B6%E4%BB%96%E5%A6%99%E7%94%A8>ControlNet的其他妙用</a></li></ul></li></ul><h1 id=玩转-stable-diffusion落地实操版>玩转 Stable diffusion（落地实操版）<a hidden class=anchor aria-hidden=true href=#玩转-stable-diffusion落地实操版>#</a></h1><h2 id=什么是-midjourneystable-diffusion>什么是 Midjourney、Stable Diffusion<a hidden class=anchor aria-hidden=true href=#什么是-midjourneystable-diffusion>#</a></h2><p>举个例子：<br>可以将他们类比为画家的手和工具，根据你打的文字和选择的不同参数，来画出你想要的作品。<br>但是画出什么风格的作品，取决于模型。<br>可以把模型类比为画家的大脑，提示词和参数就是灵感。</p><h2 id=为什么选择-stable-diffusion>为什么选择 Stable Diffusion？<a hidden class=anchor aria-hidden=true href=#为什么选择-stable-diffusion>#</a></h2><ol><li>可以在大多数配备有适度GPU的电脑硬件上运行</li><li>项目代码及模型权重开源，开源社区开发者可以在它的基础上进行二次开发</li><li>免费、无需注册</li><li>与 Midjourney 相比，配置略微繁琐。（过去式，下面将分享傻瓜式教程）</li></ol><h2 id=开发环节先在ios上跑起来简述>开发环节，先在iOS上跑起来（简述）<a hidden class=anchor aria-hidden=true href=#开发环节先在ios上跑起来简述>#</a></h2><h3 id=core-ml-stable-diffusion>Core ML Stable Diffusion<a hidden class=anchor aria-hidden=true href=#core-ml-stable-diffusion>#</a></h3><p><a href=https://github.com/apple/ml-stable-diffusion>github</a><br>苹果专门为 Stable Diffusion 推出的工具，作用有两个：</p><ol><li>将模型转换为 CoreML 格式</li><li>以 Swift 代码调用 CoreML 模型实现图像生成。</li><li>支持 CPU、GPU、NE（神经引擎、专为深度学习任务设计的硬件加速器） 等多种运行方式</li></ol><h3 id=下载模型>下载模型<a hidden class=anchor aria-hidden=true href=#下载模型>#</a></h3><p>Huggingface上已有转换好的模型，我们可以直接下载。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    @discardableResult
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>download</span>() async <span style=color:#66d9ef>throws</span> -&gt; URL {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> ready <span style=color:#f92672>||</span> downloaded { <span style=color:#66d9ef>return</span> downloadedURL }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> downloader = Downloader(from: url, to: downloadedURL)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>self</span>.downloader = downloader
</span></span><span style=display:flex><span>        downloadSubscriber = downloader.downloadState.sink { state <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>case</span> .downloading(<span style=color:#66d9ef>let</span> progress) = state {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>self</span>.state = .downloading(progress)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> downloader.waitUntilDone()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> downloadedURL
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 id=模型解压缩>模型解压缩<a hidden class=anchor aria-hidden=true href=#模型解压缩>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>unzip</span>() async <span style=color:#66d9ef>throws</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>guard</span> downloaded <span style=color:#66d9ef>else</span> { <span style=color:#66d9ef>return</span> }
</span></span><span style=display:flex><span>        state = .uncompressing
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> FileManager().unzipItem(at: downloadedURL, to: uncompressPath.url)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Cleanup if error occurs while unzipping</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> uncompressPath.delete()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> error
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> downloadedPath.delete()
</span></span><span style=display:flex><span>        state = .readyOnDisk
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 id=生成-stablediffusionpipeline>生成 StableDiffusionPipeline<a hidden class=anchor aria-hidden=true href=#生成-stablediffusionpipeline>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>     <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>load</span>(url: URL) async <span style=color:#66d9ef>throws</span> -&gt; StableDiffusionPipeline {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> beginDate = Date()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> configuration = MLModelConfiguration()
</span></span><span style=display:flex><span>        configuration.computeUnits = computeUnits
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> pipeline = <span style=color:#66d9ef>try</span> StableDiffusionPipeline(resourcesAt: url,
</span></span><span style=display:flex><span>                                                   configuration: configuration,
</span></span><span style=display:flex><span>                                                   disableSafety: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>                                                   reduceMemory: model.reduceMemory)
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Pipeline loaded in </span><span style=color:#e6db74>\(</span>Date<span style=color:#e6db74>()</span>.timeIntervalSince<span style=color:#e6db74>(</span>beginDate<span style=color:#e6db74>))</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        state = .loaded
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pipeline
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 id=文生图>文生图<a hidden class=anchor aria-hidden=true href=#文生图>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-swift data-lang=swift><span style=display:flex><span>    <span style=color:#75715e>/// Text to image generation using stable diffusion</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/// - Parameters:</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///   - prompt: Text prompt to guide sampling</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///   - negativePrompt: Negative text prompt to guide sampling</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///   - stepCount: Number of inference steps to perform</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///   - imageCount: Number of samples/images to generate for the input prompt</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///   - seed: Random seed which</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///   - guidanceScale: Controls the influence of the text prompt on sampling process (0=random images)</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///   - disableSafety: Safety checks are only performed if `self.canSafetyCheck &amp;&amp; !disableSafety`</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///   - progressHandler: Callback to perform after each step, stops on receiving false response</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/// - Returns: An array of `imageCount` optional images.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>///            The images will be nil if safety checks were performed and found the result to be un-safe</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>func</span> <span style=color:#a6e22e>generateImages</span>(
</span></span><span style=display:flex><span>        prompt: String,
</span></span><span style=display:flex><span>        negativePrompt: String = <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>        imageCount: Int = <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>        stepCount: Int = <span style=color:#ae81ff>50</span>,
</span></span><span style=display:flex><span>        seed: UInt32 = <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>        guidanceScale: Float = <span style=color:#ae81ff>7.5</span>,
</span></span><span style=display:flex><span>        disableSafety: Bool = <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        scheduler: StableDiffusionScheduler = .pndmScheduler,
</span></span><span style=display:flex><span>        progressHandler: (Progress) -&gt; Bool = { <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>in</span> <span style=color:#66d9ef>true</span> }
</span></span><span style=display:flex><span>    ) <span style=color:#66d9ef>throws</span> -&gt; [CGImage?] {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Encode the input prompt and negative prompt</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> promptEmbedding = <span style=color:#66d9ef>try</span> textEncoder.encode(prompt)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> negativePromptEmbedding = <span style=color:#66d9ef>try</span> textEncoder.encode(negativePrompt)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> reduceMemory {
</span></span><span style=display:flex><span>            textEncoder.unloadResources()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Convert to Unet hidden state representation</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Concatenate the prompt and negative prompt embeddings</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> concatEmbedding = MLShapedArray&lt;Float32&gt;(
</span></span><span style=display:flex><span>            concatenating: [negativePromptEmbedding, promptEmbedding],
</span></span><span style=display:flex><span>            alongAxis: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> hiddenStates = toHiddenStates(concatEmbedding)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>/// Setup schedulers</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> scheduler: [Scheduler] = (<span style=color:#ae81ff>0.</span>.&lt;imageCount).map { <span style=color:#66d9ef>_</span> <span style=color:#66d9ef>in</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>switch</span> scheduler {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> .pndmScheduler: <span style=color:#66d9ef>return</span> PNDMScheduler(stepCount: stepCount)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> .dpmSolverMultistepScheduler: <span style=color:#66d9ef>return</span> DPMSolverMultistepScheduler(stepCount: stepCount)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>let</span> stdev = scheduler[<span style=color:#ae81ff>0</span>].initNoiseSigma
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Generate random latent samples from specified seed</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> latents = generateLatentSamples(imageCount, stdev: stdev, seed: seed)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// De-noising loop</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (step,t) <span style=color:#66d9ef>in</span> scheduler[<span style=color:#ae81ff>0</span>].timeSteps.enumerated() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Expand the latents for classifier-free guidance</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// and input to the Unet noise prediction model</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> latentUnetInput = latents.map {
</span></span><span style=display:flex><span>                MLShapedArray&lt;Float32&gt;(concatenating: [$0, $0], alongAxis: <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Predict noise residuals from latent samples</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// and current time step conditioned on hidden states</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>var</span> noise = <span style=color:#66d9ef>try</span> unet.predictNoise(
</span></span><span style=display:flex><span>                latents: latentUnetInput,
</span></span><span style=display:flex><span>                timeStep: t,
</span></span><span style=display:flex><span>                hiddenStates: hiddenStates
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            noise = performGuidance(noise, guidanceScale)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Have the scheduler compute the previous (t-1) latent</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// sample given the predicted noise and current sample</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i <span style=color:#66d9ef>in</span> <span style=color:#ae81ff>0.</span>.&lt;imageCount {
</span></span><span style=display:flex><span>                latents[i] = scheduler[i].step(
</span></span><span style=display:flex><span>                    output: noise[i],
</span></span><span style=display:flex><span>                    timeStep: t,
</span></span><span style=display:flex><span>                    sample: latents[i]
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Report progress</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>let</span> progress = Progress(
</span></span><span style=display:flex><span>                pipeline: <span style=color:#66d9ef>self</span>,
</span></span><span style=display:flex><span>                prompt: prompt,
</span></span><span style=display:flex><span>                step: step,
</span></span><span style=display:flex><span>                stepCount: stepCount,
</span></span><span style=display:flex><span>                currentLatentSamples: latents,
</span></span><span style=display:flex><span>                isSafetyEnabled: canSafetyCheck <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>disableSafety
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>progressHandler(progress) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Stop if requested by handler</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> []
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> reduceMemory {
</span></span><span style=display:flex><span>            unet.unloadResources()
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Decode the latent samples to images</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>try</span> decodeToImages(latents, disableSafety: disableSafety)
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 id=证书设置>证书设置<a hidden class=anchor aria-hidden=true href=#证书设置>#</a></h3><p>因为占用内存较大，需要打开以下两个选项。</p><ol><li>Extended Virtual Addressing</li><li>Increased Memory Limit</li></ol><h3 id=最终效果>最终效果<a hidden class=anchor aria-hidden=true href=#最终效果>#</a></h3><p><img loading=lazy src=./14.PNG alt=14></p><h2 id=在各种设备上把-stable-diffusion-玩起来>在各种设备上把 Stable Diffusion 玩起来<a hidden class=anchor aria-hidden=true href=#在各种设备上把-stable-diffusion-玩起来>#</a></h2><h3 id=ios>iOS<a hidden class=anchor aria-hidden=true href=#ios>#</a></h3><p>在手机上可以通过 Draw Things 这款 App 来使用 Stable Diffusion，不用连网完全本地运行出图，不过目前对手机型号和系统版本有如下要求：</p><ul><li>手机设备要求 iPhone XS、XS Max、Xr、11、11 Pro、11 Pro Max、SE 2nd Gen、12、12 Mini、12 Pro、12 Pro Max、SE 3rd Gen、13、13 Mini、13 Pro、13 Pro Max、14、14 Plus、14 Pro、14 Pro Max，要求系统在 iOS 15.4 及以上。</li><li>平板设备要求 iPad Air、Mini、Pro，要求系统在 iPadOS 15.4 及以上。</li></ul><h3 id=macos>MacOS<a hidden class=anchor aria-hidden=true href=#macos>#</a></h3><p>要想在苹果 macOS 系统的电脑上把 Stable Diffusion 玩起来，有两种方案：</p><h4 id=draw-things-app>Draw Things App<a hidden class=anchor aria-hidden=true href=#draw-things-app>#</a></h4><ul><li>设备要求:<ul><li>M1/M2 芯片的 Mac Mini、Mac Studio、MacBook Air、MacBook Pro，且 macOS 系统版本在 12.4 及以上。</li></ul></li><li>Draw Things 的基础功能：<ul><li>文字生成图片</li><li>文字+图片生成图片</li><li>内补绘制（Inpainting）<ul><li>计算机视觉领域的一个任务，目的是将图片中丢失或者被损坏的部分修复，让图片恢复完整。</li><li>可用于老照片修复等场景。</li></ul></li><li>外补绘制（Outpainting）<ul><li>也被称为图像扩展或者图像预测，是计算机视觉领域的另一个任务，其目标是从已有的图像内容中预测出图像外部可能的内容。</li><li>举个例子，如果你有一张海滩的图片，外补绘制算法可能会生成海滩外的海洋或者沙滩上的其他部分。</li></ul></li></ul></li></ul><h4 id=stable-diffusion-webui>Stable Diffusion WebUI<a hidden class=anchor aria-hidden=true href=#stable-diffusion-webui>#</a></h4><p>在苹果电脑本地玩 Stable Diffusion 的另外一种方式是安装 <a href=https://github.com/AUTOMATIC1111/stable-diffusion-webui>Stable Diffusion WebUI</a>.<br>Stable Diffusion WebUI 是一个开源的基于 Gradio 库开发的用于使用 Stable Diffusion 的 Web 页面项目。<br>Gradio 则是专门用于轻松实现 AI 算法可视化部署的开源库。<br>简单来讲就是 Stable Diffusion WebUI 提供了一套 Web 页面让我们可以通过在网页上使用 Stable Diffusion 的各种能力。它长这样：
<img loading=lazy src=./sd_web_ui.png alt=sd_web_ui></p><h5 id=sd-web-ui-环境搭建-略>SD Web UI 环境搭建 （略）<a hidden class=anchor aria-hidden=true href=#sd-web-ui-环境搭建-略>#</a></h5><p>由于 Stable Diffusion WebUI 使用的 Gradio 是基于 python3 的项目，所以，搭建这套环境最主要的问题是解决 python3 的环境问题。</p><h3 id=windows-pc>Windows PC<a hidden class=anchor aria-hidden=true href=#windows-pc>#</a></h3><p>要在 Windows PC 电脑上把 Stable Diffusion 搭建起来，首先需要显卡能够满足需要，Stable Diffusion WebUI 的最低显存要求是 4GB。<br>如果显卡给力，接下来的工作就跟在 macOS 电脑上搭建的道理类似，就是把 <a href=https://github.com/AUTOMATIC1111/stable-diffusion-webui>Stable Diffusion WebUI</a>项目及依赖的 python 环境及各种依赖库给下载下来，将项目运行起来。</p><h3 id=云服务器>云服务器<a hidden class=anchor aria-hidden=true href=#云服务器>#</a></h3><p>除了在自己的 iOS、macOS、Windows 设备上搭建 Stable Diffusion 的环境之外，我们还可以在云服务器上部署 Stable Diffusion。<br>这里依然要感谢有无私的开发贡献者，把整个流程变得非常简单。这里使用的就是巴哈姆特上的一篇文章介绍的开源部署脚本在 Colab 上部署 Stable Diffusion WebUI。</p><h4 id=傻瓜式部署流程>傻瓜式部署流程<a hidden class=anchor aria-hidden=true href=#傻瓜式部署流程>#</a></h4><p><strong>Important: 根据官方声明，Colab的免费级别不适用于Stable Diffusion WebUI 😭 我们只能在付费计划中使用它。</strong></p><p>访问 Colab 傻瓜式部署 Stable Diffusion WebUI 的脚本</p><ul><li>要访问下面的服务，需要具备一定的上网条件，如果条件就绪，你可以打开这个网址：</li><li><a href="https://colab.research.google.com/drive/1lekLF7iib6M1R-NCylS0VMTF4wve-XuV?usp=sharing">https://colab.research.google.com/drive/1lekLF7iib6M1R-NCylS0VMTF4wve-XuV?usp=sharing</a>。</li></ul><ol><li>直接运行部署脚本的『前置步骤』。<ul><li>点击下列按钮开始执行『前置步骤』：</li><li><img loading=lazy src=./pre_install.jpeg alt=pre_install></li><li>成功运行完成后，会看到每一个细分步骤前有一个小绿勾。</li></ul></li><li>选择和下载需要的 SD 模型和 LoRA 模型。<ul><li>在 2.1 下载 SD 模型 这一步，参考下图选择 ChilloutMix_Ni_fix 模型：</li><li><img loading=lazy src=./download_model.jpeg alt=download_model></li><li>在 2.2 下载 Embedding + Hypernetwork + LoRA 这一步，参考下图选择所有的内置 LoRA 模型：</li><li><img loading=lazy src=./download_LoRA.png alt=download_lora></li><li>收起 2 - 下载模型，点击下列按钮开始执行『下载模型』：</li><li><img loading=lazy src=./download2.png alt=download2></li><li>同样的，成功运行完成后，会看到每一个细分步骤前有一个小绿勾。</li></ul></li><li>选择和下载需要的 Extension。<ul><li>在 3.1 下载&更新 Extensions 这一步勾选需要的扩展：</li><li><img loading=lazy src=./extrension.png alt=ex></li><li>在 3.2 下载 ControlNet 模型 这一步勾选需要的 ControlNet 模型：</li><li><img loading=lazy src=./controlNet.png alt=controlNet></li><li>收起 3 - Extension，点击下列按钮开始执行『Extension』：</li><li><img loading=lazy src=./run.png alt=run></li></ul></li><li>直接执行『其他设置』。<ul><li>点击下列按钮开始执行『其他设置』：</li><li><img loading=lazy src=./1.png alt=1></li></ul></li><li>直接执行『启动 WebUI』。<ul><li>点击下列按钮开始执行『启动 WebUI』：</li><li><img loading=lazy src=./2.png alt=2></li><li>如果顺利运行，到后面你会看到如下输出：</li><li><img loading=lazy src=./3.png alt=3></li><li>点击 public URL 进入 WebUI 页面即可开始使用了。</li></ul></li></ol><h2 id=不同方案的优势和限制>不同方案的优势和限制<a hidden class=anchor aria-hidden=true href=#不同方案的优势和限制>#</a></h2><h3 id=iphoneipad>iPhone、iPad<a hidden class=anchor aria-hidden=true href=#iphoneipad>#</a></h3><p>使用 Draw Things App：</p><ul><li>优势：<ul><li>本地出图，随时可玩</li><li>使用方便</li><li>支持中文（新版本刚支持）</li><li>支持选择模型</li><li>支持 LoRA</li><li>支持 ControlNet</li></ul></li><li>限制：<ul><li>对设备有要求， xs 以上</li><li>使用时手机发热</li><li>出图速度一般</li></ul></li></ul><h3 id=mac-os>Mac OS<a hidden class=anchor aria-hidden=true href=#mac-os>#</a></h3><h4 id=使用-draw-things-app>使用 Draw Things App：<a hidden class=anchor aria-hidden=true href=#使用-draw-things-app>#</a></h4><ul><li>优势：<ul><li>本地出图，随时可玩</li><li>使用方便</li><li>支持中文（新版本刚支持）</li><li>支持选择模型</li><li>支持 LoRA</li><li>支持 ControlNet</li><li>出图速度还可以 30s 左右</li></ul></li><li>限制：<ul><li>对设备有要求， M1 芯片</li></ul></li></ul><h4 id=使用-stable-diffusion-web-ui>使用 Stable Diffusion Web UI<a hidden class=anchor aria-hidden=true href=#使用-stable-diffusion-web-ui>#</a></h4><ul><li>优势：<ul><li>本地出图，随时可玩</li><li>支持选择模型</li><li>支持 LoRA</li><li>支持 ControlNet</li><li>有丰富的插件</li></ul></li><li>限制：<ul><li>对设备有要求， M1 芯片</li><li>比较吃内存， 建议内存32G以上</li><li>使用略复杂</li><li>需要部署</li><li>出图速度一般</li></ul></li></ul><h3 id=windows-pc-1>Windows PC<a hidden class=anchor aria-hidden=true href=#windows-pc-1>#</a></h3><h4 id=使用-stable-diffusion-web-ui-1>使用 Stable Diffusion Web UI<a hidden class=anchor aria-hidden=true href=#使用-stable-diffusion-web-ui-1>#</a></h4><ul><li>优势：<ul><li>本地出图，随时可玩</li><li>支持选择模型</li><li>支持 LoRA</li><li>支持 ControlNet</li><li>有丰富的插件</li><li>出图速度还可以 15s 左右</li></ul></li><li>限制：<ul><li>要求显卡显存 4GB 以上，内存 16GB 以上</li><li>使用略复杂</li><li>需要部署</li></ul></li></ul><h3 id=云服务器-1>云服务器<a hidden class=anchor aria-hidden=true href=#云服务器-1>#</a></h3><h4 id=使用-stable-diffusion-web-ui-2>使用 Stable Diffusion Web UI<a hidden class=anchor aria-hidden=true href=#使用-stable-diffusion-web-ui-2>#</a></h4><ul><li>优势：<ul><li>不需要考虑硬件资源</li><li>支持选择模型</li><li>支持 LoRA</li><li>支持 ControlNet</li><li>有丰富的插件</li><li>出图速度还可以 15s 左右</li></ul></li><li>限制：<ul><li>使用略复杂</li><li>需要部署</li><li>需要联网使用</li><li>使用云服务资源可能需要付费</li></ul></li></ul><h2 id=手把手教你生成一张专业摄影图>手把手教你生成一张专业摄影图<a hidden class=anchor aria-hidden=true href=#手把手教你生成一张专业摄影图>#</a></h2><h2 id=手把手教你给模特换装>手把手教你给模特换装<a hidden class=anchor aria-hidden=true href=#手把手教你给模特换装>#</a></h2><h2 id=controlnet的其他妙用>ControlNet的其他妙用<a hidden class=anchor aria-hidden=true href=#controlnet的其他妙用>#</a></h2><p><img loading=lazy src=./openPose.png alt=openpose>
<img loading=lazy src=./Canny.png alt=canny>
<img loading=lazy src=./Hed.png alt=hed>
<img loading=lazy src=./Scribble.png alt=scribble>
<img loading=lazy src=./Mlsd.png alt=mlsd>
<img loading=lazy src=./Seg.png alt=seg>
<img loading=lazy src=./normalMap.png alt=normalmap1>
<img loading=lazy src=./Depth.png alt=depth></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://jiadingyi.github.io/Tips/tags/stablediffusion/>StableDiffusion</a></li></ul><nav class=paginav><a class=prev href=https://jiadingyi.github.io/Tips/post/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AAclang%E6%8F%92%E4%BB%B6/><span class=title>« Prev</span><br><span>我的第一个Clang插件</span></a>
<a class=next href=https://jiadingyi.github.io/Tips/post/vscode%E4%B8%AD%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E6%9F%A5%E6%89%BE%E6%9B%BF%E6%8D%A2/><span class=title>Next »</span><br><span>VSCode中使用正则查找替换</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 玩转StableDiffusion on twitter" href="https://twitter.com/intent/tweet/?text=%e7%8e%a9%e8%bd%acStableDiffusion&url=https%3a%2f%2fjiadingyi.github.io%2fTips%2fpost%2f%25E7%258E%25A9%25E8%25BD%25ACstablediffusion%2f&hashtags=StableDiffusion"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 玩转StableDiffusion on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fjiadingyi.github.io%2fTips%2fpost%2f%25E7%258E%25A9%25E8%25BD%25ACstablediffusion%2f&title=%e7%8e%a9%e8%bd%acStableDiffusion&summary=%e7%8e%a9%e8%bd%acStableDiffusion&source=https%3a%2f%2fjiadingyi.github.io%2fTips%2fpost%2f%25E7%258E%25A9%25E8%25BD%25ACstablediffusion%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 玩转StableDiffusion on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fjiadingyi.github.io%2fTips%2fpost%2f%25E7%258E%25A9%25E8%25BD%25ACstablediffusion%2f&title=%e7%8e%a9%e8%bd%acStableDiffusion"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 玩转StableDiffusion on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjiadingyi.github.io%2fTips%2fpost%2f%25E7%258E%25A9%25E8%25BD%25ACstablediffusion%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 玩转StableDiffusion on whatsapp" href="https://api.whatsapp.com/send?text=%e7%8e%a9%e8%bd%acStableDiffusion%20-%20https%3a%2f%2fjiadingyi.github.io%2fTips%2fpost%2f%25E7%258E%25A9%25E8%25BD%25ACstablediffusion%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 玩转StableDiffusion on telegram" href="https://telegram.me/share/url?text=%e7%8e%a9%e8%bd%acStableDiffusion&url=https%3a%2f%2fjiadingyi.github.io%2fTips%2fpost%2f%25E7%258E%25A9%25E8%25BD%25ACstablediffusion%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 玩转StableDiffusion on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e7%8e%a9%e8%bd%acStableDiffusion&u=https%3a%2f%2fjiadingyi.github.io%2fTips%2fpost%2f%25E7%258E%25A9%25E8%25BD%25ACstablediffusion%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://jiadingyi.github.io/Tips/>Tips</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>